<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>XAU PREDATOR FINAL</title>
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<style>
body{margin:0;background:#000;color:#0f0;font-family:monospace}
#price{font-size:40px;text-align:center}
#state{font-size:20px;text-align:center}
#debug{font-size:12px;color:#f66;padding:6px}
#chart{height:70vh}
</style>
</head>
<body>

<div id="price">0.00</div>
<div id="state">WAIT</div>
<div id="debug">BOOTING...</div>
<div id="chart"></div>

<script>
const WS_URL = "wss://GANTI_DENGAN_URL_WORKER_LU";

const chart = LightweightCharts.createChart(
  document.getElementById("chart"),
  { layout:{background:{color:"#000"},textColor:"#0f0"} }
);
const candle = chart.addCandlestickSeries();
const zU = chart.addLineSeries({color:"rgba(0,255,255,.3)"});
const zL = chart.addLineSeries({color:"rgba(0,255,255,.3)"});

let lastState = "";

function connect(){
  const ws = new WebSocket(WS_URL);

  ws.onopen = () => {
    document.getElementById("debug").innerText = "WS CONNECTED";
  };

  ws.onmessage = e => {
    const d = JSON.parse(e.data);
    if(d.type!=="TICK") return;

    document.getElementById("price").innerText = d.bid;
    document.getElementById("state").innerText =
      d.discretionaryZone.bias+" | "+d.discretionaryZone.state;

    document.getElementById("debug").innerText =
      "SRC:"+d.debug.source+" | TICK:"+d.debug.tick;

    const t = Math.floor(Date.now()/1000);
    zU.setData([{time:t-60,value:d.debug.rawHigh},{time:t+60,value:d.debug.rawHigh}]);
    zL.setData([{time:t-60,value:d.debug.rawLow},{time:t+60,value:d.debug.rawLow}]);

    if(d.discretionaryZone.state==="ENTER" && lastState!=="ENTER"){
      navigator.vibrate?.([200,100,200]);
    }
    lastState = d.discretionaryZone.state;
  };

  ws.onclose = () => {
    document.getElementById("debug").innerText = "WS CLOSED - RECONNECTING";
    setTimeout(connect,2000);
  };
}

connect();
</script>
</body>
</html>
